(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B,j,F,I={}.hasOwnProperty,q=function(e,t){function r(){this.constructor=e}for(var n in t)I.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};T=null,y=null,d=null,m=null,c=Backbone.View.extend({initialize:function(e){return T.on("showPopup",this.onShowPopup,this)},events:{"submit form":"onSubmitForm","click  .icon-remove":"onClickIconRemove"},render:function(){},onShowPopup:function(t,n){var r,i=this;return t!==this.name?!1:(this.model=n,r=b(n.get("new")),this.$(".shortcut").html(_.map(r.split(" + "),function(e){return"<span>"+e+"</span>"}).join("+")),this.render(),this.$el.show().draggable({cursor:"move",delay:200,cancel:"input,textarea,button,select,option,.bookmarkPanel",stop:function(){return i.onStopSort()}}),this.el.style.pixelLeft=Math.round((window.innerWidth-this.el.offsetWidth)/2),this.el.style.pixelTop=Math.round((window.innerHeight-this.el.offsetHeight)/2),e(".backscreen").show())},onStopSort:function(){},onClickIconRemove:function(){return this.hidePopup()},hidePopup:function(){return e(".backscreen").hide(),this.$el.hide()},tmplHelp:_.template('<a href="helpview.html#<%=name%>" target="_blank" class="help" title="help">\n  <i class="icon-question-sign" title="Help"></i>\n</a>')}),g={closeOtherTabs:["tab","Close other tabs"],closeTabsLeft:["tab","Close tabs to the left"],closeTabsRight:["tab","Close tabs to the right"],moveTabLeft:["tab","Move current tab left"],moveTabRight:["tab","Move current tab right"],moveTabFirst:["tab","Move current tab to first position"],moveTabLast:["tab","Move current tab to last position"],duplicateTab:["tab","Duplicate a current tab"],duplicateTabWin:["tab","Duplicate a current tab to a new window"],pinTab:["tab","Pin/Unpin a current tab"],detachTab:["tab","Detaches a current tab"],attachTab:["tab","Attaches a current tab to the next window"],switchPrevWin:["win","Switches to the previous window"],switchNextWin:["win","Switches to the next window"],closeOtherWins:["win","Close other windows"],pasteText:["custom","Paste text",[],"Clip"],insertCSS:["custom","Insert CSS",[{value:"allFrames",caption:"All frames"}],"CSS"],execJS:["custom","Execute script",[{value:"allFrames",caption:"All frames"},{value:"useUtilObj",caption:"Use Utility Object"}],"JS"]},v={tab:"Tab commands",win:"Window commands",clip:"Clipboard commands",custom:"Other"},r=function(t){function n(e){n.__super__.constructor.call(this,e),y.on("showPopup",this.onShowPopup,this)}return q(n,t),n.prototype.name="commandOptions",n.prototype.el=".commandOptions",n.prototype.render=function(){var e,t=this;return this.$(".command").text(g[this.command.name][1]),this.$(".caption").val(this.command.caption),this.$(".content").val(this.command.content),e=this.$(".inputs").empty(),g[this.command.name][2].forEach(function(n){return n.checked="",t.command[n.value]&&(n.checked="checked"),e.append(t.tmplOptions(n))}),this.$el.append(this.tmplHelp(this))},n.prototype.onShowPopup=function(e,t,r){this.command=r;if(!n.__super__.onShowPopup.call(this,e,t))return;return this.command.content?this.$(".content").focus()[0].setSelectionRange(0,0):this.$(".caption").focus(),H()},n.prototype.onSubmitForm=function(){var t,n,r,i=this;return(n=this.$(".content").val())!==""&&(r={},e.each(this.$(".inputs input[type='checkbox']"),function(e,t){r[t.value]=t.checked}),(t=this.$(".caption").val())||(t=n.split("\n")[0]),this.trigger("setCommand",this.model.id,_.extend({name:this.command.name,category:this.command.category,caption:t,content:n},r)),this.hidePopup()),!1},n.prototype.hidePopup=function(){return w(),n.__super__.hidePopup.call(this)},n.prototype.tmplOptions=_.template('<label>\n  <input type="checkbox" value="<%=value%>" <%=checked%>> <%=caption%>\n</label><br>'),n}(c),i=function(e){function t(){return F=t.__super__.constructor.apply(this,arguments),F}return q(t,e),t.prototype.name="command",t.prototype.el=".commands",t.prototype.render=function(){var e,t,n;n=this.$(".commandRadios"),n.empty(),e=[];for(t in g)e.push(g[t][0]);e=_.unique(e),e.forEach(function(e){return n.append('<div class="cat'+e+'"><div class="catname">'+v[e]+"</div>")});for(t in g)n.find(".cat"+g[t][0]).append(this.tmplItem({key:t,value:g[t][1]}));return this},t.prototype.onShowPopup=function(e,n,r){if(!t.__super__.onShowPopup.call(this,e,n))return;return r&&this.$(".radioCommand").val([r.name]),this.$el.append(this.tmplHelp(this))},t.prototype.onSubmitForm=function(){var e,t;if(t=this.$(".radioCommand:checked").val())this.hidePopup(),(e=g[t][0])==="custom"||t==="pasteText"?this.trigger("showPopup","commandOptions",this.model,{name:t}):this.trigger("setCommand",this.model.id,{name:t});return!1},t.prototype.tmplItem=_.template('<div>\n  <label>\n    <input type="radio" name="radioCommand" class="radioCommand" value="<%=key%>">\n    <%=value%>\n  </label>\n</div>'),t}(c),t=function(t){function n(e){n.__super__.constructor.call(this,e),d.on("showPopup",this.onShowPopup,this)}return q(n,t),n.prototype.name="bookmarkOptions",n.prototype.el=".bookmarkOptions",n.prototype.events=_.extend({"click input[value='findtab']":"onClickFindTab"},c.prototype.events),n.prototype.render=function(){var e,t;return n.__super__.render.call(this),this.$(".bookmark").css("background-image","-webkit-image-set(url(chrome://favicon/size/16@1x/"+this.bookmark.url+") 1x)").text(this.bookmark.title),this.$(".url").text(this.bookmark.url),this.$(".findStr").val(this.bookmark.findStr||this.bookmark.url),this.$("input[value='"+(this.bookmark.openmode||"current")+"']")[0].checked=!0,(e=this.$("input[value='findtab']")[0]).checked=(t=this.bookmark.findtab)===void 0?!0:t,this.onClickFindTab({currentTarget:e}),this.$el.append(this.tmplHelp(this))},n.prototype.onShowPopup=function(e,t,r){this.bookmark=r;if(!n.__super__.onShowPopup.call(this,e,t))return;return H()},n.prototype.onSubmitForm=function(){var t,n=this;return t={},e.each(this.$("form input[type='checkbox']"),function(e,n){t[n.value]=n.checked}),t.findtab=this.$("input[value='findtab']").is(":checked"),t.openmode=this.$("input[name='openmode']:checked").attr("value"),t.findStr=this.$(".findStr").val(),this.trigger("setBookmark",this.model.id,_.extend(this.bookmark,t)),this.hidePopup(),!1},n.prototype.onClickFindTab=function(e){return e.currentTarget.checked?this.$(".findStr").removeAttr("disabled"):this.$(".findStr").attr("disabled","disabled").blur()},n.prototype.hidePopup=function(){return w(),n.__super__.hidePopup.call(this)},n}(c),n=function(t){function n(e){var t;n.__super__.constructor.call(this,e),this.elBookmark$=this.$(".result"),t=document.getCSSCanvasContext("2d","triangle",8,5.5),t.fillStyle="#000000",t.translate(.5,.5),t.beginPath(),t.moveTo(0,0),t.lineTo(0,1),t.lineTo(3.5,4.5),t.lineTo(7,1),t.lineTo(7,0),t.closePath(),t.fill(),t.stroke(),this.$(".result_outer").niceScroll({cursorwidth:12,cursorborderradius:6,smoothscroll:!0,cursoropacitymin:.1,cursoropacitymax:.6})}return q(n,t),n.prototype.name="bookmark",n.prototype.el=".bookmarks",n.prototype.events=_.extend({"click  a":"onClickBookmark","click  .title":"onClickFolder","click  .expand-icon":"onClickExpandIcon","click  .expand":"onClickExpand"},c.prototype.events),n.prototype.render=function(){var e;return e=window.innerHeight-60,this.$(".result_outer").height(e-35),this.$el.height(e),this.$(".result").children().length===0&&this.onSubmitForm(),this},n.prototype.onClickFolder=function(t){var n,r;return r=(n=e(t.currentTarget).parent()).hasClass("opened"),r?n.removeClass("opened expanded"):n.addClass("opened expanded"),j(),t.stopPropagation()},n.prototype.onClickExpandIcon=function(t){var n,r;return n=(r=e(t.currentTarget).parent()).hasClass("expanded"),n?r.removeClass("expanded"):r.addClass("expanded"),j(),t.stopPropagation()},n.prototype.onClickExpand=function(){return this.$(".expand").is(":checked")?this.$(".folder").addClass("opened expanded"):this.$(".folder").removeClass("opened expanded"),j()},n.prototype.onShowPopup=function(e,t){var r;if(!n.__super__.onShowPopup.call(this,e,t))return;return(r=this.$("input.query")).val()&&r.focus(),this.$(".result_outer").getNiceScroll().show()},n.prototype.onSubmitForm=function(){var t,n,r=this;return this.$(".result").empty(),t=this.$("input.query").focus().val(),t&&(this.$(".expand")[0].checked=!0),n=this.$(".expand").is(":checked")?"opened expanded":"",chrome.bookmarks.getTree(function(i){var s;return i.forEach(function(e){return r.digBookmarks(e,r.elBookmark$,t,0,n)}),r.elBookmark$.append(s=e(r.tmplFolder({title:"Recent",state:n,indent:0}))),s.find(".title").prepend('<img src="images/star.png">'),chrome.bookmarks.getRecent(50,function(e){return e.forEach(function(e){return r.digBookmarks(e,s,t,1,n)})})}),!1},n.prototype.digBookmarks=function(t,n,r,i,s){var o,u=this;if(t.title){t.state=s;if(t.children)t.indent=i,n.append(o=e(this.tmplFolder(t))),n=o;else if(!r||(t.title+" "+t.url).toUpperCase().indexOf(r.toUpperCase())>-1)t.indent=i+1,n.append(e(this.tmplLink(t)))}else i--;if(t.children)return n.parent().addClass("hasFolder"),t.children.forEach(function(e){return u.digBookmarks(e,n,r,i+1,s)})},n.prototype.hidePopup=function(){return this.$(".result_outer").getNiceScroll().hide(),n.__super__.hidePopup.call(this)},n.prototype.onClickBookmark=function(t){var n;return this.hidePopup(),n=e(t.currentTarget),this.trigger("showPopup","bookmarkOptions",this.model,{title:n.text(),url:n.attr("title"),bmId:n.attr("data-id")}),!1},n.prototype.onStopSort=function(){return this.$(".result_outer").getNiceScroll().resize()},n.prototype.tmplFolder=_.template('<div class="folder <%=state%>" style="text-indent:<%=indent%>em">\n  <span class="expand-icon"></span><span class="title"><%=title%></span>\n</div>'),n.prototype.tmplLink=_.template('<div class="link" style="text-indent:<%=indent%>em;">\n  <a href="#" title="<%=url%>" data-id="<%=id%>" style="background-image:-webkit-image-set(url(\'chrome://favicon/size/16@1x/<%=url%>\') 1x);"><%=title%></a>\n</div>'),n}(c),x={},N=null,h={google:{families:["Noto+Sans::latin"]}},k={remap:["Remap","icon-random"],command:["Command...","icon-cog"],bookmark:["Bookmark...","icon-bookmark"],simEvent:["DOM Key Event","icon-font"],disabled:["Disabled","icon-ban-circle"],through:["Pause","icon-pause","nodisp"]},p={current:"Open in current tab",newtab:"Open in new tab",newwin:"Open in new window",incognito:"Open in incognito window"},E=function(e){var t;return t={"&":"&amp;","<":"&lt;",">":"&gt;"},e.replace(/[&<>]/g,function(e){return t[e]})},A=["Ctrl","Alt","Shift","Win","MouseL","MouseR","MouseM"],L=["c","a","s","w"],b=function(e){var t,n,r,i,s,o,u;i=parseInt(e.substring(0,2),16),s=e.substring(2);if(r=N[s]){n=[];for(t=o=0,u=A.length;0<=u?o<u:o>u;t=0<=u?++o:--o)i&Math.pow(2,t)&&n.push(A[t]);return i&4?n.push(r[1]||r[0]):n.push(r[0]),n.join(" + ")}},B=function(e){var t,n,r,i,s,o,u;i=parseInt(e.substring(0,2),16),n=[];for(t=o=0,u=L.length;0<=u?o<u:o>u;t=0<=u?++o:--o)i&Math.pow(2,t)&&n.push(L[t]);return s=e.substring(2),r=N[s],"["+n.join("")+"]"+r[0]},o=Backbone.View.extend({scHelpUrl:"https://support.google.com/chrome/answer/157179?hl=",el:"div.header",events:{"click button.addKeyConfig":"onClickAddKeyConfig"},initialize:function(t){var n,r,i=this;return N=x[n=this.model.get("kbdtype")].keys,r=this.$("select.kbdtype"),e.each(x,function(e,t){return r.append('<option value="'+e+'">'+t.name+"</option>")}),r.val(n),this.setScHelp(n)},onClickAddKeyConfig:function(e){return this.trigger("clickAddKeyConfig",e)},onChangeSelKbd:function(e){return this.trigger("changeSelKbd",e),this.setScHelp(this.$("select.kbdtype").val())},setScHelp:function(e){return this.$(".scHelp").text("ショートカットキー一覧").attr("href",this.scHelpUrl+"ja")},setScHelp0:function(e){return e==="JP"?this.$(".scHelp").text("ショートカットキー一覧").attr("href",this.scHelpUrl+"ja"):this.$(".scHelp").text("Keyboard shortcuts").attr("href",this.scHelpUrl+"en")}}),s=Backbone.Model.extend({}),u=Backbone.Model.extend({idAttribute:"new",defaults:{mode:"remap"}}),a=Backbone.Collection.extend({model:u}),l=Backbone.View.extend({kbdtype:null,optionKeys:[],events:{"click .origin,.new":"onClickInput","click div.mode":"onClickMode","click .selectMode div":"onChangeMode","click div.edit":"onClickEdit","click div.copySC,div.copyKD":"onClickCopySC","click div.pause":"onClickPause","click div.resume":"onClickResume","click div.delete":"onClickRemove","click input.memo":"onClickInputMemo","click button.cog":"onClickCog","submit .memo":"onSubmitMemo","blur  .selectMode":"onBlurSelectMode","blur  .selectCog":"onBlurSelectCog","blur  input.memo":"onBlurInputMemo"},initialize:function(e){return this.optionKeys=_.keys(k),this.model.on({"change:bookmark":this.onChangeBookmark,"change:command":this.onChangeCommand,setFocus:this.onClickInput,remove:this.onRemove},this),this.model.collection.on({kbdEvent:this.onKbdEvent,changeKbd:this.onChangeKbd,updateOrder:this.onUpdateOrder},this)},render:function(e){var t;return this.setElement(this.template({options:k})),t=this.model.get("mode"),this.setKbdValue(this.$(".new"),this.model.id)||(this.state="invalid"),this.setKbdValue(this.$(".origin"),this.model.get("origin")),this.kbdtype=e,this.onChangeMode(null,t),this},onChangeBookmark:function(){return this.onChangeMode(null,"bookmark")},onChangeCommand:function(){return this.onChangeMode(null,"command")},onRemove:function(){return this.model.off(null,null,this),this.off(null,null,null),this.remove()},onKbdEvent:function(t){var n;n=this.$("div:focus");if(n.length>0){if(n.hasClass("new")){if(this.model.id!==t&&this.model.collection.findWhere({"new":t})){e("#tiptip_content").text('"'+b(t)+'" is already exists.'),n.tipTip();return}}else if(~~t.substring(2)>512)return;return this.setKbdValue(n,t),this.model.set(n[0].className.match(/(new|origin)/)[0],t),this.setDesc(),this.trigger("resizeInput")}},onChangeKbd:function(e){return this.kbdtype=e,this.setKbdValue(this.$(".new"),this.model.id),this.setKbdValue(this.$(".origin"),this.model.get("origin")),this.setDesc()},onUpdateOrder:function(){return this.model.set("ordernum",this.$el.parent().children().index(this.$el))},onClickCopySC:function(e){var t,n,r,i,s,o;return i=b(this.model.id).replace(/\s/g,""),n=this.$("td.options .mode").text().replace("None",""),n&&(n=" "+n+":"),/copySC/.test(e.currentTarget.className)?(s="send",r=this.$(".desc").find(".content,.command,.commandCaption,.bookmark,.memo").text()):(s="keydown",r=this.$(".desc").find(".content").text()),r&&(r=" "+r),t="tsc."+s+"('"+B(this.model.id)+"');",o=t+" /* "+i+n+r+" */",chrome.runtime.sendMessage({action:"setClipboard",value1:o},function(e){})},onClickInputMemo:function(){return event.stopPropagation()},onSubmitMemo:function(){return this.$("form.memo").hide(),this.model.set({memo:this.$("div.memo").show().html(E(this.$("input.memo").val())).text()}),w(),!1},onClickMode:function(){return this.$(".selectMode").toggle().is(":visible")?(this.$(".selectMode").focus(),this.$(".mode").addClass("selecting")):this.$(".mode").removeClass("selecting"),event.stopPropagation()},onChangeMode:function(e,t){if(e){this.$(".mode").removeClass("selecting"),t=e.currentTarget.className,this.$(".selectMode").hide();if(t==="bookmark"||t==="command"){this.trigger("showPopup",t,this.model,this.model.get(t));return}}return this.model.set("mode",t),this.setDispMode(t),this.setDesc(),this.trigger("resizeInput")},onBlurSelectMode:function(){return this.$(".selectMode").hide(),this.$(".mode").removeClass("selecting")},onClickInput:function(t,n){return t?e(t.currentTarget).focus():n?this.$(n).focus():this.$(".origin").focus(),t!=null?t.stopPropagation():void 0},onBlurInputMemo:function(){return this.onSubmitMemo()},onClickCog:function(t){return this.$(".selectCog").toggle().is(":visible")?(this.$(".selectCog").focus(),e(t.currentTarget).addClass("selecting")):e(t.currentTarget).removeClass("selecting"),t.stopPropagation()},onBlurSelectCog:function(){return this.$(".selectCog").hide(),this.$("button.cog").removeClass("selecting")},onClickEdit:function(e){var t,n,r,i;switch(i=this.model.get("mode")){case"bookmark":return this.trigger("showPopup","bookmarkOptions",this.model,this.model.get("bookmark"));case"command":return this.trigger("showPopup","commandOptions",this.model,this.model.get("command"));default:return(r=this.$("div.memo")).toggle(),t=(n=this.$("form.memo").toggle().find("input.memo")).is(":visible"),t?(n.focus().val(r.text()),H()):this.onSubmitMemo(),e.stopPropagation()}},onClickPause:function(){return this.model.set("lastMode",this.model.get("mode")),this.onChangeMode(null,"through")},onClickResume:function(){return this.onChangeMode(null,this.model.get("lastMode"))},onClickRemove:function(){var e;e=b(this.model.id);if(confirm("Are you sure you want to delete this shortcut?\n\n '"+e+"'"))return this.trigger("removeConfig",this.model)},setDispMode:function(e){return this.$(".mode").attr("title",k[e][0].replace("...","")).find(".icon")[0].className="icon "+k[e][1],e==="through"&&(e=this.model.get("lastMode")+" through"),this.$(".new,.origin,.icon-arrow-right").removeClass(this.optionKeys.join(" ")).addClass(e),/remap/.test(e)?(this.$(".origin").attr("tabIndex","0"),this.$("th:first").removeAttr("colspan"),this.$("th:eq(1),th:eq(2)").show()):(this.$(".origin").removeAttr("tabIndex"),this.$("th:first").attr("colspan","3"),this.$("th:eq(1),th:eq(2)").hide())},setKbdValue:function(e,t){var n;return(n=b(t))?(e.html(_.map(n.split(" + "),function(e){return"<span>"+e+"</span>"}).join("+")),!0):!1},setDesc:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,d,v,m,y,b,w,E,S,x,T;(b=this.$(".desc")).empty(),a={iconName:"",command:""},(m=this.model.get("mode"))==="through"&&(y=!0,m=this.model.get("lastMode"));switch(m){case"bookmark":e=this.model.get("bookmark"),b.append(this.tmplBookmark({openmode:p[e.openmode],url:e.url,title:e.title})),a={iconName:"icon-cog",command:"Edit bookmark..."};break;case"command":u=(n=g[r=this.model.get("command").name])[1];if((o=n[0])==="custom"||r==="pasteText"){s=[],t=this.model.get("command"),v=t.content.split("\n");for(l=E=0,x=v.length;0<=x?E<x:E>x;l=0<=x?++E:--E){if(l>2){s[l-1]+=" ...";break}s.push(v[l].replace(/"/g,"'"))}b.append(this.tmplCommandCustom({ctg:n[3],desc:u,content3row:s.join("\n"),caption:t.caption}))}else b.append(this.tmplCommand({desc:u,ctg:o.substring(0,1).toUpperCase()+o.substring(1)}));if(o==="custom"||r==="pasteText")a={iconName:"icon-cog",command:"Edit command..."};break;case"remap":case"disabled":d=this.kbdtype==="JP"?"ja":"en",m==="remap"?h=this.$(".origin").text():h=this.$(".new").text(),h=h.replace(/\s/g,"").toUpperCase(),(f=D[h])||/^CTRL\+[2-7]$/.test(h)&&(f=D["CTRL+1"]);if(f)for(l=S=0,T=f[d].length;0<=T?S<T:S>T;l=0<=T?++S:--S)w=f[d][l].match(/(^\w+)\^(.+)/),c=RegExp.$1,i=RegExp.$2,b.append(this.tmplHelp({sectDesc:P[c],sectKey:c,scHelp:i})).find(".sectInit").tooltip({position:{my:"left+10 top-60"}})}return b.html()===""&&(b.append(this.tmplMemo({memo:this.model.get("memo")})),a={iconName:"icon-pencil",command:"Edit description..."}),b.append(this.tmplDesc(a)),a.iconName===""&&b.find(".edit").remove(),y?b.find(".pause").remove():b.find(".resume").remove()},tmplDesc:_.template('<button class="cog small"><i class="icon-caret-down"></i></button>\n<div class="selectCog" tabIndex="0">\n  <div class="edit"><i class="<%=iconName%>"></i> <%=command%></div>\n  <div class="copySC"><i class="icon-paper-clip"></i> Copy send method</div>\n  <div class="copyKD"><i class="icon-paper-clip"></i> Copy keydown method</div>\n  <span class="seprater"><hr style="margin:3px 1px" noshade></span>\n  <div class="pause"><i class="icon-pause"></i> Pause</div>\n  <div class="resume"><i class="icon-play"></i> Resume</div>\n  <span class="seprater"><hr style="margin:3px 1px" noshade></span>\n  <div class="delete"><i class="icon-remove"></i> Delete</div>\n</div>'),tmplMemo:_.template('<form class="memo">\n  <input type="text" class="memo">\n</form>\n<div class="memo"><%=memo%></div>'),tmplBookmark:_.template('<div class="bookmark" title="<<%=openmode%>>\n<%=url%>" style="background-image:-webkit-image-set(url(chrome://favicon/size/16@1x/<%=url%>) 1x);"><%=title%></div>'),tmplCommand:_.template('<div class="ctgIcon <%=ctg%>"><%=ctg%></div><div class="command"><%=desc%></div>'),tmplCommandCustom:_.template('<div class="ctgIcon <%=ctg%>"><%=ctg%></div>\n<div class="command"><%=desc%>:</div><div class="commandCaption" title="<%=content3row%>"><%=caption%></div>'),tmplHelp:_.template('<div class="sectInit" title="<%=sectDesc%>"><%=sectKey%></div><div class="content"><%=scHelp%></div>'),template:_.template('<tr class="data">\n  <th>\n    <div class="new" tabIndex="0"></div>\n  </th>\n  <th>\n    <i class="icon-arrow-right"></i>\n  </th>\n  <th class="tdOrigin">\n    <div class="origin" tabIndex="0"></div>\n  </th>\n  <td class="options">\n    <div class="mode"><i class="icon"></i><span></span><i class="icon-caret-down"></i></div>\n    <div class="selectMode" tabIndex="0">\n      <% _.each(options, function(option, key) { if (option[2] != "nodisp") { %>\n      <div class="<%=key%>"><i class="icon <%=option[1]%>"></i> <%=option[0]%></div>\n      <% }}); %>\n    </div>\n  <td class="desc"></td>\n  <td class="blank">&nbsp;</td>\n</tr>')}),f=Backbone.View.extend({placeholder:"Enter new shortcut key",el:"table.keyConfigSetView",events:{"click .addnew":"onClickAddnew","blur  .addnew":"onBlurAddnew",click:"onClickBlank"},initialize:function(e){return this.collection.comparator=function(e){return e.get("ordernum")},this.collection.on({add:this.onAddRender,kbdEvent:this.onKbdEvent},this)},render:function(t){var n=this;return this.$el.append(this.template()),this.collection.set(t),this.$("tbody").sortable({delay:300,scroll:!0,cursor:"move",update:function(){return n.onUpdateSort()},start:function(){return n.onStartSort()},stop:function(){return n.onStopSort()}}),e(".fixed-table-container-inner").niceScroll({cursorwidth:12,cursorborderradius:2,smoothscroll:!0,cursoropacitymin:.3,cursoropacitymax:.7,zindex:999998}),this.niceScroll=e(".fixed-table-container-inner").getNiceScroll(),this},onAddRender:function(e){var t,n;t=new l({model:e}),t.on("removeConfig",this.onChildRemoveConfig,this),t.on("resizeInput",this.onChildResizeInput,this),t.on("showPopup",this.onShowPopup,this),this.$("tbody").append(n=t.render(this.model.get("kbdtype")).$el).append(this.tmplBorder);if(t.state==="invalid")return this.onChildRemoveConfig(e)},onKbdEvent:function(t){var n,r,i,s;if(this.$(".addnew").length===0){if((s=this.$(".new:focus,.origin:focus")).length!==0)return;if(n=this.collection.get(t)){n.trigger("setFocus",null,".new");return}if(!this.onClickAddKeyConfig())return}if(this.collection.findWhere({"new":t})){e("#tiptip_content").text('"'+b(t)+'" is already exists.'),this.$("div.addnew").tipTip();return}return this.$("div.addnew").blur(),~~t.substring(2)>512?i="0130":i=t,this.collection.add(r=new u({"new":t,origin:i})),this.$("tbody").sortable("enable").sortable("refresh"),j(),this.onChildResizeInput(),r.trigger("setFocus")},onChildRemoveConfig:function(e){return this.collection.remove(e),this.onStopSort(),j(),this.onChildResizeInput()},onChildResizeInput:function(){var e=this;return this.$(".th_inner").css("left",0),setTimeout(function(){return e.$(".th_inner").css("left","")},0)},onShowPopup:function(e,t,n){return this.trigger("showPopup",e,t,n)},onSetBookmark:function(e,t){return this.collection.get(e).set({bookmark:t},{silent:!0}).trigger("change:bookmark")},onSetCommand:function(e,t){return this.collection.get(e).set({command:t},{silent:!0}).trigger("change:command")},onClickAddKeyConfig:function(t){if(this.$(".addnew").length>0)return;return this.collection.length>50?(e("#tiptip_content").text("You have reached the maximum number of items. (Max 50 items)"),e(t.currentTarget).tipTip({defaultPosition:"left"}),!1):(e(this.tmplAddNew({placeholder:this.placeholder})).appendTo(this.$("tbody")).find(".addnew").focus()[0].scrollIntoView(),this.$("tbody").sortable("disable"),j(),!0)},onClickBlank:function(){return this.$(":focus").blur()},onClickAddnew:function(e){return e.stopPropagation()},onBlurAddnew:function(){return this.$(".addnew").remove(),this.$("tbody").sortable("enable"),j()},onChangeSelKbd:function(e){var t;return N=x[t=e.currentTarget.value].keys,this.collection.trigger("changeKbd",t),this.model.set("kbdtype",t)},onStartSort:function(){return this.$(".ui-sortable-placeholder").next("tr.border").remove()},onStopSort:function(){var t,n=this;e.each(this.$("tbody tr"),function(t,r){var i,s,o;if(r.className==="data"){if(((s=e(r).next("tr")[0])!=null?s.className:void 0)!=="border")return e(r).after(n.tmplBorder)}else if(((o=(i=e(r).next("tr"))[0])!=null?o.className:void 0)!=="data")return i.remove()});if((t=this.$("tbody tr:first"))[0].className==="border")return t.remove()},onUpdateSort:function(){return this.collection.trigger("updateOrder"),this.collection.sort()},getSaveData:function(){return this.collection.remove(this.collection.findWhere({"new":this.placeholder})),{config:this.model.toJSON(),keyConfigSet:this.collection.toJSON()}},tmplAddNew:_.template('<tr class="addnew">\n  <th colspan="3">\n    <div class="new addnew" tabIndex="0"><%=placeholder%></div>\n  </th>\n  <td></td><td></td><td class="blank"></td>\n</tr>'),tmplBorder:'<tr class="border">\n  <td colspan="5"><div class="border"></div></td>\n  <td></td>\n</tr>',template:_.template('<thead>\n  <tr>\n    <th>\n      <div class="th_inner">New <i class="icon-arrow-right"></i> Origin shortcut key</div>\n    </th>\n    <th></th>\n    <th></th>\n    <th>\n      <div class="th_inner options">Mode</div>\n    </th>\n    <th>\n      <div class="th_inner desc">Description</div>\n    </th>\n    <th><div class="th_inner blank">&nbsp;</div></th>\n  </tr>\n</thead>\n<tbody></tbody>')}),C=0,O=!1,j=function(){return O&&clearTimeout(O),O=setTimeout(function(){var t;return t=window.innerHeight-document.querySelector(".header").offsetHeight-C,document.querySelector(".fixed-table-container").style.pixelHeight=t,e(".fixed-table-container-inner").getNiceScroll().resize(),e(".result_outer").getNiceScroll().resize()},200)},S=chrome.extension.getBackgroundPage().fk,M=S.getConfig(),x=S.getKeyCodes(),D=S.getScHelp(),P=S.getScHelpSect(),H=function(){return S.startEdit()},w=function(){return S.endEdit()},e=jQuery,e(function(){var u,l;return l=new o({model:new s(M.config)}),l.render(),T=new f({model:new s(M.config),collection:new a}),T.render(M.keyConfigSet),d=new n({}),u=new t({}),y=new i({}),m=new r({}),l.on("clickAddKeyConfig",T.onClickAddKeyConfig,T),l.on("changeSelKbd",T.onChangeSelKbd,T),y.on("setCommand",T.onSetCommand,T),m.on("setCommand",T.onSetCommand,T),u.on("setBookmark",T.onSetBookmark,T),chrome.runtime.onMessage.addListener(function(e,t,n){switch(e.action){case"kbdEvent":return T.collection.trigger("kbdEvent",e.value);case"saveConfig":return S.saveConfig(T.getSaveData())}}),e(window).on("unload",function(){return S.saveConfig(T.getSaveData())}).on("resize",function(){return j()}),e(".beta").text("β"),j()})}).call(this);